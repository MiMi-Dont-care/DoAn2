<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Ghi nhận doanh thu hàng ngày - Chủ cửa hàng</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/grid.css">
    <link rel="stylesheet" href="../css/color.css">
    <link rel="stylesheet" href="../css/typography.css">
    <link rel="stylesheet" href="../css/button.css">
    <link rel="stylesheet" href="../css/flex.css">
    <link rel="stylesheet" href="../css/franchisee.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
</head>

<body>
    <!-- Header -->
    <header class="franchisee-header">
        <div class="logo"><i class="fas fa-store"></i> Mì Cay Đức Hiệu - CN Quận 1</div>
        <div class="user-menu"><i class="fas fa-user-circle"></i> Nguyễn Văn Anh (Chủ cửa hàng)</div>
    </header>

  <!-- Sidebar -->
  <aside class="franchisee-sidebar">
    <ul>
      <li><a href="dashboard.html" style="color: black; text-decoration: none;"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
      <li class="active"><a href="revenue.html" style="color: black; text-decoration: none;"><i class="fas fa-dollar-sign"></i> Doanh thu</a></li>
      <li><a href="contract.html" target="_blank" style="color: black; text-decoration: none;"><i class="fas fa-file-contract"></i> Hợp đồng</a></li>
      <li><a href="promotion.html" style="color: black; text-decoration: none;"><i class="fas fa-tags"></i> Khuyến mãi</a></li>
      <li><a href="notification.html" style="color: black; text-decoration: none;"><i class="fas fa-bell"></i> Thông báo</a></li>
    </ul>
  </aside>

    <!-- Main -->
    <main class="franchisee-main">
        <h1 class="fs-2 fw-bold mb-3">Ghi nhận doanh thu hằng ngày</h1>

        <!-- Form -->
        <form id="revenueForm" class="form mb-3" style="max-width:500px;">
            <div class="form-group">
                <label for="date">Ngày</label>
                <input type="date" id="date" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="amount">Doanh thu (triệu)</label>
                <input type="number" id="amount" class="form-control" min="0" step="0.1" required>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Lưu</button>
                <button type="reset" class="btn btn-secondary"><i class="fas fa-undo"></i> Nhập lại</button>
            </div>
        </form>

        <!-- Bảng doanh thu -->
        <div class="table-box mt-3">
            <table class="franchisee-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Ngày</th>
                        <th>Doanh thu (triệu)</th>
                    </tr>
                </thead>
                <tbody id="revenueTableBody">
                    <tr>
                        <td colspan="3" class="text-center">Chưa có dữ liệu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="franchisee-pagination"></div>
    </main>

    <!-- Script -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("revenueForm");
            const tableBody = document.getElementById("revenueTableBody");
            const pagination = document.getElementById("pagination");

            let revenues = JSON.parse(localStorage.getItem("revenues")) || [];
            let currentPage = 1;
            const itemsPerPage = 10;

            // Sắp xếp theo ngày mới nhất
            function sortRevenues() {
                revenues.sort((a, b) => new Date(b.reportDate) - new Date(a.reportDate));
            }

            // Render bảng
            function renderTable(data, page = 1) {
                sortRevenues(); // luôn sort trước khi render
                tableBody.innerHTML = "";
                const start = (page - 1) * itemsPerPage;
                const end = page * itemsPerPage;
                const pageData = data.slice(start, end);

                if (pageData.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="3" class="text-center">Không có dữ liệu</td></tr>`;
                    return;
                }

                pageData.forEach((r, index) => {
                    tableBody.innerHTML += `
          <tr>
            <td>${start + index + 1}</td>
            <td>${r.reportDate}</td>
            <td class="amount">${r.revenue.toLocaleString()}</td>
          </tr>
        `;
                });

                renderPagination(data.length, page);
            }

            // Phân trang
            function renderPagination(totalItems, page) {
                pagination.innerHTML = "";
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                if (totalPages <= 1) return;

                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement("button");
                    btn.className = "btn " + (i === page ? "active" : "");
                    btn.textContent = i;
                    btn.addEventListener("click", () => {
                        currentPage = i;
                        renderTable(revenues, currentPage);
                    });
                    pagination.appendChild(btn);
                }
            }

            // Thêm mới
            form.addEventListener("submit", function (e) {
                e.preventDefault();
                const reportDate = document.getElementById("date").value;
                const revenue = parseInt(document.getElementById("amount").value);

                revenues.push({
                    id: Date.now(),
                    reportDate,
                    revenue
                });

                localStorage.setItem("revenues", JSON.stringify(revenues));
                renderTable(revenues, currentPage);
                form.reset();
            });

            // Load dữ liệu ban đầu
            renderTable(revenues, currentPage);
        });
    </script>

</body>

</html>